<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Checkout | B&M Trading LLP</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="navbar"><div class="navbar-inner"><div class="brand">B&M Trading LLP</div><div class="nav-links"><a href="index.html">Home</a><a href="cart.html">Cart</a></div></div></header>
  <div style="height:64px;"></div>

  <main class="container" style="padding:30px;">
    <div class="card" style="padding:20px;">
      <h1>Checkout</h1>
      <div id="cartSummary"></div>
      <form id="orderForm" style="margin-top:12px;">
        <input name="name" id="name" placeholder="Full name" style="width:100%;padding:8px;margin:6px 0;border-radius:8px;border:1px solid #e6e9ef;" required>
        <input name="phone" id="phone" placeholder="Phone" style="width:100%;padding:8px;margin:6px 0;border-radius:8px;border:1px solid #e6e9ef;" required>
        <input name="address" id="address" placeholder="Delivery address" style="width:100%;padding:8px;margin:6px 0;border-radius:8px;border:1px solid #e6e9ef;" required>
        <textarea name="note" id="note" placeholder="Note (optional)" style="width:100%;padding:8px;margin:6px 0;border-radius:8px;border:1px solid #e6e9ef;"></textarea>
        <div style="text-align:center;"><button class="btn" type="submit">Place Order (WhatsApp)</button></div>
      </form>
      <div id="thanks" class="hidden" style="text-align:center;margin-top:12px;color:green;font-weight:700;">Thank you! Your order was placed.</div>
    </div>
  </main>

  <script>
    function renderSummary(){
      const cart = JSON.parse(localStorage.getItem('cart')||'[]');
      const cEl = document.getElementById('cartSummary'); cEl.innerHTML='';
      let total=0;
      cart.forEach(it=>{
        const div = document.createElement('div'); div.style.display='flex'; div.style.justifyContent='space-between'; div.style.padding='8px 0';
        div.innerHTML = `<div>${it.name}</div><div>KSh ${Number(it.price).toLocaleString()}</div>`;
        cEl.appendChild(div); total+=Number(it.price);
      });
      const t = document.createElement('div'); t.style.textAlign='right'; t.style.fontWeight='700'; t.textContent='Total: KSh '+total.toLocaleString(); cEl.appendChild(t);
    }
    renderSummary();

    document.getElementById('orderForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const name=document.getElementById('name').value;
      const phone=document.getElementById('phone').value;
      const address=document.getElementById('address').value;
      const cart = JSON.parse(localStorage.getItem('cart')||'[]'); if(!cart.length){ alert('Cart empty'); return; }
      let msg = `New order from ${name}%0APhone: ${phone}%0AAddress: ${address}%0A%0AItems:%0A`;
      let total=0;
      cart.forEach((it,i)=>{ msg += `${i+1}. ${it.name} - KSh ${Number(it.price).toLocaleString()}%0A`; total+=Number(it.price); });
      msg += `%0ATotal: KSh ${total.toLocaleString()}`;
      // open WhatsApp to notify owner
      window.open(`https://wa.me/254720300388?text=${msg}`, '_blank');
      localStorage.removeItem('cart');
      document.getElementById('thanks').classList.remove('hidden');
      setTimeout(()=> location.href='index.html', 2000);
    });
  </script>
</body>
</html>
